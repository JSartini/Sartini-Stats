<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Joseph Sartini">
  <meta name="dcterms.date" content="2025-01-31">
  <title>Sartini-Stats - STAN Introduction</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">STAN Introduction</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Joseph Sartini 
</div>
</div>
</div>

  <p class="date">2025-01-31</p>
</section>
<section id="what-is-stan" class="slide level2">
<h2>What is STAN?</h2>
<div>
<ul>
<li><p>Bayesian probabilistic programming language</p></li>
<li><p>Multiple posterior sampling routines</p>
<ul>
<li><p>Hamiltonian Monte Carlo</p></li>
<li><p>Variational Inference</p></li>
<li><p>Laplace approximation</p></li>
</ul></li>
<li><p>Based on C++</p></li>
<li><p>Interfaces with Python, Julia, R, and Unix Shell</p></li>
</ul>
</div>
</section>
<section id="structure-of-a-stan-script" class="slide level2">
<h2>Structure of a STAN Script</h2>
<div class="cell" data-output.var="blank">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb1-1"><a></a><span class="kw">functions</span> {</span>
<span id="cb1-2"><a></a>  <span class="co">// ... function declarations and definitions ...</span></span>
<span id="cb1-3"><a></a>}</span>
<span id="cb1-4"><a></a><span class="kw">data</span> {</span>
<span id="cb1-5"><a></a>  <span class="co">// ... declarations ...</span></span>
<span id="cb1-6"><a></a>}</span>
<span id="cb1-7"><a></a><span class="kw">transformed data</span> {</span>
<span id="cb1-8"><a></a>   <span class="co">// ... declarations ... statements ...</span></span>
<span id="cb1-9"><a></a>}</span>
<span id="cb1-10"><a></a><span class="kw">parameters</span> {</span>
<span id="cb1-11"><a></a>   <span class="co">// ... declarations ...</span></span>
<span id="cb1-12"><a></a>}</span>
<span id="cb1-13"><a></a><span class="kw">transformed parameters</span> {</span>
<span id="cb1-14"><a></a>   <span class="co">// ... declarations ... statements ...</span></span>
<span id="cb1-15"><a></a>}</span>
<span id="cb1-16"><a></a><span class="kw">model</span> {</span>
<span id="cb1-17"><a></a>   <span class="co">// ... declarations ... statements ...</span></span>
<span id="cb1-18"><a></a>}</span>
<span id="cb1-19"><a></a><span class="kw">generated quantities</span> {</span>
<span id="cb1-20"><a></a>   <span class="co">// ... declarations ... statements ...</span></span>
<span id="cb1-21"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>All blocks are optional, an empty string is actually a valid STAN code. Order is important, they must be in the above order Variables have scope over all subsequent blocks</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---functions" class="slide level2">
<h2>Section - functions</h2>
<div>
<ul>
<li><p>Complex indexing</p>
<ul>
<li>Sparsely observed data</li>
</ul></li>
<li><p>Generating quantities/structures</p>
<ul>
<li>Splines, etc.</li>
</ul></li>
<li><p>Suffixes for particular functions</p>
<ul>
<li><p>Containing RNG: “_rng”</p></li>
<li><p>Modifying target density: “_lp”</p></li>
</ul></li>
</ul>
</div>
<aside class="notes">
<p>RNG functions can only be used on data/generated quantities</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---data" class="slide level2">
<h2>Section - data</h2>
<div>
<ul>
<li><p>Likelihood data</p>
<ul>
<li>Indexing arrays</li>
</ul></li>
<li><p>All constants</p>
<ul>
<li>Array extents</li>
</ul></li>
<li><p>Commonly used linear transforms</p></li>
</ul>
</div>
<aside class="notes">
<p>Often need more information in this block than you think to fully specify the model.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---transformed-data" class="slide level2">
<h2>Section - transformed data</h2>
<div>
<ul>
<li><p>Functions of data variables</p></li>
<li><p>Only evaluated once</p>
<ul>
<li>Prior to sampling</li>
</ul></li>
<li><p>Helpful for book-keeping</p>
<ul>
<li>Simplify data inputs</li>
</ul></li>
<li><p>Random data sub-samples</p></li>
</ul>
</div>
</section>
<section id="section---parameters" class="slide level2">
<h2>Section - parameters</h2>
<div>
<ul>
<li><p>Specify sampled quantities</p>
<ul>
<li><p>Variable names</p></li>
<li><p>Extents</p></li>
</ul></li>
<li><p>Definitions only, no statements</p></li>
<li><p>Read from underlying sampler</p></li>
<li><p>Can provide initial values</p></li>
</ul>
</div>
<aside class="notes">
<ul>
<li>Will get more into how to provide initial values shortly</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---transformed-parameters" class="slide level2">
<h2>Section - transformed parameters</h2>
<div>
<ul>
<li><p>Deterministic functions</p></li>
<li><p>Part of target posterior</p></li>
<li><p>Evaluated with each sample</p>
<ul>
<li><p>Inverse transform</p></li>
<li><p>Log absolute Jacobian</p></li>
</ul></li>
<li><p>Good for re-parameterization</p>
<ul>
<li><p>Stability</p></li>
<li><p>Latent modeling</p></li>
</ul></li>
</ul>
</div>
<aside class="notes">
<ul>
<li><p>Can include data, transformed data, and parameters as inputs</p></li>
<li><p>Need inverse transform and log absolute Jacobian to be efficient, as they can greatly slow down the sampling process otherwise</p></li>
<li><p>Natural scale vs sampling efficiency (NUTS and standard HMC prefer unconstrained parameters). However, gradient calculations usually dwarf these differences</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---model" class="slide level2">
<h2>Section - model</h2>
<div>
<ul>
<li><p>Define the target posterior</p>
<ul>
<li>Sum of log density functions</li>
</ul></li>
<li><p>Prior distributions on (transformed) parameters</p></li>
<li><p>Data/model likelihood</p></li>
<li><p>Most computational expense</p></li>
<li><p>ORDER MATTERS</p></li>
</ul>
</div>
<aside class="notes">
<p>It is often important to know which subgroup of operations within the model block is consuming the majority of computation time (after deciding that efficient is insufficient). We will get to how this can be done (do not optimize unless necessary).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="section---generated-quantities" class="slide level2">
<h2>Section - generated quantities</h2>
<div>
<ul>
<li><p>Executed after samples are generated</p></li>
<li><p>Functions of model output</p>
<ul>
<li><p>Predictions for new data</p></li>
<li><p>Simulate new data</p></li>
<li><p>Extract posterior estimates</p></li>
<li><p>Calculate model fit criterion</p></li>
</ul></li>
</ul>
</div>
</section>
<section id="example-model---glm" class="slide level2">
<h2>Example Model - GLM</h2>
<div class="cell" data-output.var="first_model">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb2-1"><a></a><span class="kw">data</span> {</span>
<span id="cb2-2"><a></a>  <span class="dt">int</span> N;  <span class="co">// Number of observations</span></span>
<span id="cb2-3"><a></a>  <span class="dt">int</span> P;  <span class="co">// Number of fixed effect covariates</span></span>
<span id="cb2-4"><a></a>  </span>
<span id="cb2-5"><a></a>  <span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; Y;  <span class="co">// Binary outcomes</span></span>
<span id="cb2-6"><a></a>  <span class="dt">matrix</span>[N, P] X;                    <span class="co">// Fixed effects design matrix</span></span>
<span id="cb2-7"><a></a>}</span>
<span id="cb2-8"><a></a><span class="kw">parameters</span> {</span>
<span id="cb2-9"><a></a>   <span class="dt">vector</span>[P] beta;  <span class="co">// Coefficients</span></span>
<span id="cb2-10"><a></a>}</span>
<span id="cb2-11"><a></a><span class="kw">model</span> {</span>
<span id="cb2-12"><a></a>   Y ~ bernoulli_logit(X * beta);</span>
<span id="cb2-13"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<p>While there is no explicit prior on beta here, that just means that STAN is choosing the equivalent to a uniform prior under the hood</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="running-the-model-in-r" class="slide level2">
<h2>Running the Model in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>fit_df <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a></a>  <span class="fu">mutate</span>(<span class="at">Efficient =</span> <span class="fu">case_when</span>(mpg <span class="sc">&gt;=</span> <span class="fu">median</span>(mpg) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb3-3"><a></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a></a>  <span class="fu">mutate</span>(<span class="at">am =</span> <span class="fu">as.factor</span>(am))</span>
<span id="cb3-5"><a></a>fit_matrix <span class="ot">=</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>cyl <span class="sc">+</span> disp <span class="sc">+</span> hp <span class="sc">+</span> drat <span class="sc">+</span> wt <span class="sc">+</span> am, fit_df)</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a>data_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(mtcars), <span class="at">P =</span> <span class="fu">ncol</span>(fit_matrix), </span>
<span id="cb3-8"><a></a>                 <span class="at">Y =</span> fit_df<span class="sc">$</span>Efficient, <span class="at">X =</span> fit_matrix)</span>
<span id="cb3-9"><a></a></span>
<span id="cb3-10"><a></a>model <span class="ot">=</span> <span class="fu">sampling</span>(</span>
<span id="cb3-11"><a></a>  first_model, </span>
<span id="cb3-12"><a></a>  <span class="at">data =</span> data_list, </span>
<span id="cb3-13"><a></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb3-14"><a></a>  <span class="at">iter =</span> <span class="dv">1000</span>, </span>
<span id="cb3-15"><a></a>  <span class="at">warmup =</span> <span class="dv">500</span>, </span>
<span id="cb3-16"><a></a>  <span class="co"># init = ,</span></span>
<span id="cb3-17"><a></a>  <span class="co"># control = list(adapt_delta = , </span></span>
<span id="cb3-18"><a></a>  <span class="co">#                max_treedepth = , </span></span>
<span id="cb3-19"><a></a>  <span class="co">#                stepsize_jitter = ), </span></span>
<span id="cb3-20"><a></a>  <span class="at">verbose =</span> F,</span>
<span id="cb3-21"><a></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb3-22"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convergence-monitoring" class="slide level2">
<h2>Convergence Monitoring</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="fu">check_hmc_diagnostics</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Divergences:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>0 of 2000 iterations ended with a divergence.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Tree depth:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>1212 of 2000 iterations saturated the maximum tree depth of 10 (60.6%).
Try increasing 'max_treedepth' to avoid saturation.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Energy:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>E-BFMI indicated no pathological behavior.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">summary</span>(model)<span class="sc">$</span>summary[,<span class="st">"Rhat"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> beta[1]  beta[2]  beta[3]  beta[4]  beta[5]  beta[6]  beta[7]     lp__ 
2.365263 2.081568 2.424803 2.459833 2.446590 1.643589 2.438779 1.039459 </code></pre>
</div>
</div>
</section>
<section id="hamiltonian-monte-carlo" class="slide level2">
<h2>Hamiltonian Monte Carlo</h2>

<img data-src="../resources/images/Hamiltonian_Monte_Carlo.gif" class="r-stretch quarto-figure-center"><p class="caption">HMC Visualization: By Justinkunimune - github.com/jkunimune/hamiltonian-mc, CC0</p></section>
<section id="hamiltonian-monte-carlo-continued" class="slide level2">
<h2>Hamiltonian Monte Carlo Continued</h2>
<div>
<ul>
<li><p>Version of Metropolis-Hastings</p></li>
<li><p>Hamiltonian Dynamics used to propose next state</p>
<ul>
<li><p>Trajectory with momentum</p></li>
<li><p>Distribution <span class="math inline">\(\approx\)</span> potential energy field</p></li>
<li><p>Leapfrog integrator stepwise approximation</p></li>
</ul></li>
<li><p>Momentum: reduced correlation between samples</p></li>
<li><p>Energy conservation: high acceptance probability</p></li>
</ul>
</div>
<aside class="notes">
<ul>
<li><p>Leapfrog integrator uses model gradient to take steps, why it is important to keep this efficient (analytical gradients built-in by STAN for many things)</p></li>
<li><p>Use MH step to compensate for numerical issues in the Leapfrog algorithm, but acceptance probability should be high if things go well (not needed in perfect world)</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="divergences" class="slide level2">
<h2>Divergences</h2>
<div>
<ul>
<li><p>Simulated trajectory <span class="math inline">\(\neq\)</span> true trajectory</p></li>
<li><p>Global step size <span class="math inline">\(&gt;\)</span> true posterior geometry resolution</p>
<ul>
<li>Leapfrog first order approximataion</li>
</ul></li>
<li><p>Hamiltonian departs from initial value</p>
<ul>
<li><p>Total energy (kinetic + potential)</p></li>
<li><p>Should be preserved along trajectory</p></li>
</ul></li>
<li><p>Sampler WILL NOT accept samples after divergence</p></li>
</ul>
</div>
</section>
<section id="tree-depth-warnings" class="slide level2">
<h2>Tree Depth Warnings</h2>
<div>
<ul>
<li><p>Tree depth controls number of simulation steps</p>
<ul>
<li><span class="math inline">\(\leq 2^{max\_treedepth}\)</span> steps</li>
</ul></li>
<li><p>Primarily an efficiency concern</p></li>
<li><p>Generally recommended to not increase</p>
<ul>
<li>Often model misspecification</li>
</ul></li>
</ul>
</div>
</section>
<section id="est.-bayesian-fraction-of-miss.-info." class="slide level2">
<h2>Est. Bayesian Fraction of Miss. Info.</h2>
<div>
<ul>
<li><p>Posterior decomposes into energy equivalence classes</p></li>
<li><p>Low EBFMI indicates getting “stuck” in energy sets</p>
<ul>
<li>STAN monitors energy during sampling</li>
</ul></li>
<li><p>Insufficiently exploring the posterior</p>
<ul>
<li>Tails too large, etc</li>
</ul></li>
</ul>
</div>
</section>
<section id="geometric-intuition" class="slide level2">
<h2>Geometric Intuition</h2>

<img data-src="STAN_Intro_files/figure-revealjs/intuition_figure-1.png" width="960" class="r-stretch"></section>
<section id="return-to-our-example-model-outputs" class="slide level2 scrollable">
<h2>Return to our Example: Model Outputs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>samples <span class="ot">=</span> <span class="fu">extract</span>(model)</span>
<span id="cb13-2"><a></a></span>
<span id="cb13-3"><a></a>beta_0 <span class="ot">=</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(samples<span class="sc">$</span>beta)[<span class="dv">1</span>], <span class="cf">function</span>(x){</span>
<span id="cb13-4"><a></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">beta0 =</span> samples<span class="sc">$</span>beta[x,<span class="dv">1</span>], </span>
<span id="cb13-5"><a></a>                    <span class="at">Sample =</span> x))</span>
<span id="cb13-6"><a></a>}) <span class="sc">%&gt;%</span> <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="STAN_Intro_files/figure-revealjs/pma_vis-1.png" width="960" class="r-stretch"></section>
<section id="model-outputs-2" class="slide level2 scrollable">
<h2>Model Outputs (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>samples <span class="ot">=</span> <span class="fu">extract</span>(model, <span class="st">"beta"</span>, <span class="at">permuted =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-2"><a></a></span>
<span id="cb14-3"><a></a>beta_0 <span class="ot">=</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(samples)[<span class="dv">1</span>], <span class="cf">function</span>(x){</span>
<span id="cb14-4"><a></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">beta0 =</span> samples[x,,<span class="dv">1</span>], </span>
<span id="cb14-5"><a></a>                    <span class="at">Chain =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb14-6"><a></a>                    <span class="at">sample =</span> x))</span>
<span id="cb14-7"><a></a>}) <span class="sc">%&gt;%</span> <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="STAN_Intro_files/figure-revealjs/sms_vis-1.png" width="960" class="r-stretch"></section>
<section id="shinystan-debugging" class="slide level2">
<h2>ShinySTAN Debugging</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="fu">launch_shinystan</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="../resources/images/ShinySTAN.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="shinystan---nuts-summary" class="slide level2">
<h2>ShinySTAN - NUTS Summary</h2>

<img data-src="../resources/images//Diagnose_NUTS.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="shinystan---divergences" class="slide level2">
<h2>ShinySTAN - Divergences</h2>

<img data-src="../resources/images//Diagnose_Diverge.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="shinystan---treedepth" class="slide level2">
<h2>ShinySTAN - Treedepth</h2>

<img data-src="../resources/images//Diagnose_Treedepth.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="shinystan---energy" class="slide level2">
<h2>ShinySTAN - Energy</h2>

<img data-src="../resources/images//Diagnose_Energy.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="shinystan---autocorrelation" class="slide level2">
<h2>ShinySTAN - Autocorrelation</h2>

<img data-src="../resources/images//Autocorrelation.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="how-to-update-the-model" class="slide level2">
<h2>How to Update the Model</h2>
<div class="cell" data-output.var="second_model">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb16-1"><a></a><span class="kw">data</span> {</span>
<span id="cb16-2"><a></a>  <span class="dt">int</span> N;  <span class="co">// Number of observations</span></span>
<span id="cb16-3"><a></a>  <span class="dt">int</span> P;  <span class="co">// Number of fixed effect covariates</span></span>
<span id="cb16-4"><a></a>  </span>
<span id="cb16-5"><a></a>  <span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; Y;  <span class="co">// Binary outcomes</span></span>
<span id="cb16-6"><a></a>  <span class="dt">matrix</span>[N, P] X;                    <span class="co">// Fixed effects design matrix</span></span>
<span id="cb16-7"><a></a>}</span>
<span id="cb16-8"><a></a><span class="kw">transformed data</span> {</span>
<span id="cb16-9"><a></a>  <span class="dt">matrix</span>[N, P] Q_coef = qr_thin_Q(X) * sqrt(N<span class="dv">-1</span>);</span>
<span id="cb16-10"><a></a>  <span class="dt">matrix</span>[P, P] R_coef = qr_thin_R(X) / sqrt(N<span class="dv">-1</span>);</span>
<span id="cb16-11"><a></a>  <span class="dt">matrix</span>[P, P] R_coef_inv = inverse(R_coef);</span>
<span id="cb16-12"><a></a>}</span>
<span id="cb16-13"><a></a><span class="kw">parameters</span> {</span>
<span id="cb16-14"><a></a>  <span class="dt">vector</span>[P] theta;  <span class="co">// Coefficients</span></span>
<span id="cb16-15"><a></a>}</span>
<span id="cb16-16"><a></a><span class="kw">model</span> {</span>
<span id="cb16-17"><a></a>  theta ~ normal(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb16-18"><a></a>  Y ~ bernoulli_logit(Q_coef * theta);</span>
<span id="cb16-19"><a></a>}</span>
<span id="cb16-20"><a></a><span class="kw">generated quantities</span> {</span>
<span id="cb16-21"><a></a>  <span class="dt">vector</span>[P] beta = R_coef_inv * theta;</span>
<span id="cb16-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-the-updated-model" class="slide level2">
<h2>Running the Updated Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>model <span class="ot">=</span> <span class="fu">sampling</span>(</span>
<span id="cb17-2"><a></a>  second_model, </span>
<span id="cb17-3"><a></a>  <span class="at">data =</span> data_list, </span>
<span id="cb17-4"><a></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb17-5"><a></a>  <span class="at">iter =</span> <span class="dv">2500</span>, </span>
<span id="cb17-6"><a></a>  <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb17-7"><a></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>),</span>
<span id="cb17-8"><a></a>  <span class="at">verbose =</span> F,</span>
<span id="cb17-9"><a></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb17-10"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="updated-model-performance" class="slide level2">
<h2>Updated Model Performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">check_hmc_diagnostics</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Divergences:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>0 of 6000 iterations ended with a divergence.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Tree depth:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>0 of 6000 iterations saturated the maximum tree depth of 10.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Energy:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>E-BFMI indicated no pathological behavior.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">summary</span>(model)<span class="sc">$</span>summary[,<span class="st">"Rhat"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta[1] theta[2] theta[3] theta[4] theta[5] theta[6] theta[7]  beta[1] 
1.003796 1.003760 1.001931 1.003562 1.003605 1.003334 1.003570 1.002406 
 beta[2]  beta[3]  beta[4]  beta[5]  beta[6]  beta[7]     lp__ 
1.001364 1.003667 1.003591 1.003552 1.000757 1.003570 1.001324 </code></pre>
</div>
</div>
</section>
<section id="updated-model-visualization" class="slide level2 scrollable">
<h2>Updated Model Visualization</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="STAN_Intro_files/figure-revealjs/vis_v2-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="STAN_Intro_files/figure-revealjs/vis_v2-2.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="updated-geometry" class="slide level2">
<h2>Updated Geometry</h2>

<img data-src="STAN_Intro_files/figure-revealjs/intuition_update-1.png" width="960" class="r-stretch"></section>
<section id="profiling-the-model-with-cmdstanr-1" class="slide level2">
<h2>Profiling the Model with CmdStanR (1)</h2>
<div class="cell" data-output.var="Profile_Mod">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource stan number-lines code-with-copy"><code class="sourceCode stan"><span id="cb27-1"><a></a><span class="kw">data</span> {</span>
<span id="cb27-2"><a></a>  <span class="dt">int</span> N;  <span class="co">// Number of observations</span></span>
<span id="cb27-3"><a></a>  <span class="dt">int</span> P;  <span class="co">// Number of fixed effect covariates</span></span>
<span id="cb27-4"><a></a>  </span>
<span id="cb27-5"><a></a>  <span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt; Y;  <span class="co">// Binary outcomes</span></span>
<span id="cb27-6"><a></a>  <span class="dt">matrix</span>[N, P] X;                    <span class="co">// Fixed effects design matrix</span></span>
<span id="cb27-7"><a></a>}</span>
<span id="cb27-8"><a></a><span class="kw">transformed data</span> {</span>
<span id="cb27-9"><a></a>  <span class="dt">matrix</span>[N, P] Q_coef = qr_thin_Q(X) * sqrt(N<span class="dv">-1</span>);</span>
<span id="cb27-10"><a></a>  <span class="dt">matrix</span>[P, P] R_coef = qr_thin_R(X) / sqrt(N<span class="dv">-1</span>);</span>
<span id="cb27-11"><a></a>  <span class="dt">matrix</span>[P, P] R_coef_inv = inverse(R_coef);</span>
<span id="cb27-12"><a></a>}</span>
<span id="cb27-13"><a></a><span class="kw">parameters</span> {</span>
<span id="cb27-14"><a></a>  <span class="dt">vector</span>[P] theta;  <span class="co">// Coefficients</span></span>
<span id="cb27-15"><a></a>}</span>
<span id="cb27-16"><a></a><span class="kw">model</span> {</span>
<span id="cb27-17"><a></a>  <span class="cf">profile</span>(<span class="st">"Priors"</span>) {</span>
<span id="cb27-18"><a></a>    <span class="kw">target +=</span> normal_lpdf(theta| <span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb27-19"><a></a>  }</span>
<span id="cb27-20"><a></a>  <span class="cf">profile</span>(<span class="st">"Likelihood"</span>) {</span>
<span id="cb27-21"><a></a>    <span class="kw">target +=</span> bernoulli_logit_lpmf(Y| Q_coef * theta);</span>
<span id="cb27-22"><a></a>  }</span>
<span id="cb27-23"><a></a>}</span>
<span id="cb27-24"><a></a><span class="kw">generated quantities</span> {</span>
<span id="cb27-25"><a></a>  <span class="cf">profile</span>(<span class="st">"Generated"</span>) {</span>
<span id="cb27-26"><a></a>    <span class="dt">vector</span>[P] beta = R_coef_inv * theta;</span>
<span id="cb27-27"><a></a>  }</span>
<span id="cb27-28"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="profiling-the-model-with-cmdstanr-2" class="slide level2">
<h2>Profiling the Model with CmdStanR (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>model <span class="ot">=</span> <span class="fu">cmdstan_model</span>(<span class="st">"Profile_Mod.stan"</span>)</span>
<span id="cb28-2"><a></a>fit <span class="ot">=</span> model<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> data_list, <span class="at">chains =</span> <span class="dv">1</span>)</span>
<span id="cb28-3"><a></a>fit<span class="sc">$</span><span class="fu">profiles</span>()[[<span class="dv">1</span>]][,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        name  total_time forward_time reverse_time autodiff_calls
1  Generated 0.000175152  0.000175152   0.00000000              0
2 Likelihood 0.145845000  0.116126000   0.02971880         170759
3     Priors 0.026700700  0.023262300   0.00343839         170759</code></pre>
</div>
</div>
</section>
<section id="resource-links" class="slide level2">
<h2>Resource Links</h2>
<ul>
<li><p><a href="https://mc-stan.org/docs/reference-manual/">STAN Manual</a></p></li>
<li><p><a href="https://arxiv.org/pdf/1701.02434">Introduction to HMC</a></p></li>
<li><p><a href="https://arxiv.org/pdf/2011.01808">Bayesian Workflow</a></p></li>
</ul>
<aside class="notes">
<p>Intro to HMC by Michael Betancourt</p>
<p>Bayesian Workflow by Gelman et. al.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>